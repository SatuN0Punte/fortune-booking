const form = document.getElementById('bookingForm');
const submitBtn = document.getElementById('submitBtn');
const loader = document.getElementById('loader');
const confirmation = document.getElementById('confirmation');
const confirmDetails = document.getElementById('confirmDetails');
const bookAgainBtn = document.getElementById('bookAgainBtn');
const timeSelect = document.getElementById('time');
const dateInput = document.getElementById('date');

function validateForm() {
  const name = form.name.value.trim();
  const phone = form.phone.value.trim();
  const date = form.date.value;
  const time = form.time.value;

  // เช็คว่าค่าครบและเบอร์โทรถูก pattern
  const phoneValid = /^[0-9]{9,10}$/.test(phone);

  if(name && phoneValid && date && time) {
    submitBtn.disabled = false;
  } else {
    submitBtn.disabled = true;
  }
}

// เรียก validate ทุกครั้งที่มีการเปลี่ยนแปลงข้อมูล
form.name.addEventListener('input', validateForm);
form.phone.addEventListener('input', validateForm);
dateInput.addEventListener('change', () => {
  validateForm();
  // โหลดเวลาว่าง (จำลอง)
  loader.classList.add('visible');
  timeSelect.innerHTML = '<option disabled>กำลังโหลดเวลาว่าง...</option>';

  setTimeout(() => {
    loader.classList.remove('visible');
    timeSelect.innerHTML = `
      <option value="" disabled selected>เลือกเวลาที่ว่าง</option>
      <option value="10:00">10:00</option>
      <option value="10:30">10:30</option>
      <option value="11:00">11:00</option>
    `;
    validateForm(); // ตรวจสอบอีกครั้งหลังโหลดเวลา
  }, 1000);
});
timeSelect.addEventListener('change', validateForm);

// เริ่มด้วยปิดปุ่ม
submitBtn.disabled = true;

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  submitBtn.disabled = true; // ปิดปุ่มเพื่อกันกดซ้ำ
  loader.classList.add('visible');

  const name = form.name.value.trim();
  const phone = form.phone.value.trim();
  const date = form.date.value;
  const time = form.time.value;

  setTimeout(() => {
    loader.classList.remove('visible');
    form.style.display = 'none';
    confirmation.classList.add('visible');
    confirmDetails.textContent = `
      ชื่อ: ${name}
      เบอร์โทร: ${phone}
      วันที่: ${date}
      เวลา: ${time}
    `;
  }, 1500);
});

bookAgainBtn.addEventListener('click', () => {
  confirmation.classList.remove('visible');
  form.style.display = '';
  form.reset();
  timeSelect.innerHTML = '<option value="" disabled selected>เลือกเวลาที่ว่าง</option>';
  submitBtn.disabled = true;
});
