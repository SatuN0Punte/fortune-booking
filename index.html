<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏î‡∏π‡∏î‡∏ß‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏°‡∏∏‡∏Å‡∏î‡∏≤ ‡∏ï‡∏≤‡∏ó‡∏¥‡∏û‡∏¢‡πå</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet" />
<style>
  :root {
    --color-primary: #1A237E;
    --color-accent: #6A1B9A;
    --color-gold: #FFD700;
    --color-bg: #F9F9FA;
    --color-text: #222;
    --border-radius: 12px;
    --transition-speed: 0.3s;
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 24px 12px;
    font-family: 'Prompt', sans-serif;
    background: var(--color-bg);
    color: var(--color-text);
    display: flex;
    justify-content: center;
    min-height: 100vh;
  }
  .container {
    max-width: 420px;
    width: 100%;
    background: white;
    border-radius: var(--border-radius);
    box-shadow:
      0 2px 6px rgba(26, 35, 126, 0.12),
      0 6px 12px rgba(106, 27, 154, 0.12);
    padding: 32px 28px;
    display: flex;
    flex-direction: column;
  }
  h1 {
    margin: 0 0 24px 0;
    font-weight: 700;
    font-size: 1.9rem;
    color: var(--color-primary);
    text-align: center;
  }
  form {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  label {
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--color-primary);
    margin-bottom: 6px;
    display: block;
  }
  input[type="text"],
  input[type="tel"],
  input[type="date"],
  select {
    width: 100%;
    padding: 12px 14px;
    border: 1.8px solid #ccc;
    border-radius: var(--border-radius);
    font-size: 1rem;
    color: var(--color-text);
    background: #fff;
    transition: border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
  }
  input[type="text"]:focus,
  input[type="tel"]:focus,
  input[type="date"]:focus,
  select:focus {
    outline: none;
    border-color: var(--color-gold);
    box-shadow: 0 0 8px var(--color-gold);
  }

  .datetime-group {
    display: flex;
    gap: 16px;
  }
  .datetime-group > div {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  button#submitBtn {
    margin-top: 12px;
    background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
    border: none;
    border-radius: var(--border-radius);
    padding: 14px 0;
    color: #fff;
    font-weight: 700;
    font-size: 1.2rem;
    box-shadow: 0 5px 12px rgba(106, 27, 154, 0.5);
    cursor: pointer;
    transition: background var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
  }
  button#submitBtn:hover {
    background: var(--color-gold);
    color: #000;
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.8);
  }

  .loader {
    margin: 18px auto 0;
    border: 4px solid #eee;
    border-top: 4px solid var(--color-primary);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    animation: spin 1s linear infinite;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }
  .loader.visible {
    opacity: 1;
    pointer-events: auto;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  #confirmation {
    margin-top: 28px;
    text-align: center;
    color: var(--color-primary);
    font-weight: 600;
    display: none;
    flex-direction: column;
    gap: 14px;
  }
  #confirmation.visible {
    display: flex;
  }
  #confirmDetails {
    border: 1.5px solid var(--color-accent);
    background: #f3e9ff;
    padding: 18px 22px;
    border-radius: var(--border-radius);
    font-size: 1.05rem;
    white-space: pre-line;
    word-break: break-word;
  }
  button#bookAgainBtn {
    background: var(--color-gold);
    border: none;
    border-radius: var(--border-radius);
    padding: 12px 28px;
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button#bookAgainBtn:hover {
    background: var(--color-primary);
    color: #fff;
  }

  @media (max-width: 480px) {
    .datetime-group {
      flex-direction: column;
    }
    .container {
      padding: 24px 20px;
    }
    h1 {
      font-size: 1.6rem;
    }
    button#submitBtn {
      font-size: 1.1rem;
    }
  }
</style>
</head>
<body>
  <main class="container">
    <h1>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏î‡∏π‡∏î‡∏ß‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏°‡πà‡∏°‡∏∏‡∏Å‡∏î‡∏≤ ‡∏ï‡∏≤‡∏ó‡∏¥‡∏û‡∏¢‡πå</h1>

    <form id="bookingForm" autocomplete="off" novalidate>
      <div>
        <label for="name">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
        <input type="text" id="name" name="name" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required />
      </div>
      <div>
        <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
        <input type="tel" id="phone" name="phone" placeholder="0812345678" pattern="[0-9]{9,10}" required />
      </div>
      <div>
        <label for="lineId">Line ID</label>
        <input type="text" id="lineId" name="lineId" placeholder="Line ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required />
      </div>

      <div class="datetime-group">
        <div>
          <label for="date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
          <input type="date" id="date" name="date" required />
        </div>
        <div>
          <label for="time">‡πÄ‡∏ß‡∏•‡∏≤</label>
          <select id="time" name="time" required>
            <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á</option>
          </select>
        </div>
      </div>

      <button type="submit" id="submitBtn">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</button>
      <div id="loader" class="loader" aria-hidden="true"></div>
    </form>

    <section id="confirmation" aria-live="polite" role="region" aria-atomic="true">
      <div id="confirmDetails"></div>
      <button id="bookAgainBtn" type="button">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏´‡∏°‡πà</button>
    </section>
  </main>

  <script>
    const API_URL = "https://script.google.com/macros/s/YOUR_DEPLOYED_SCRIPT_URL/exec";

    const form = document.getElementById('bookingForm');
    const loader = document.getElementById('loader');
    const confirmation = document.getElementById('confirmation');
    const confirmDetails = document.getElementById('confirmDetails');
    const bookAgainBtn = document.getElementById('bookAgainBtn');
    const timeSelect = document.getElementById('time');
    const dateInput = document.getElementById('date');

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å API
    async function fetchAvailableTimes(date) {
      if (!date) return [];
      try {
        const res = await fetch(`${API_URL}?action=checkAvailable&date=${date}`);
        const data = await res.json();
        if (data.success && Array.isArray(data.availableTimes)) {
          return data.availableTimes;
        }
        return [];
      } catch (err) {
        console.error('Error fetching available times:', err);
        return [];
      }
    }

    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô
    dateInput.addEventListener('change', async () => {
      loader.classList.add('visible');
      timeSelect.innerHTML = '<option disabled>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡πà‡∏≤‡∏á...</option>';

      const date = dateInput.value;
      const availableTimes = await fetchAvailableTimes(date);

      if (availableTimes.length === 0) {
        timeSelect.innerHTML = '<option disabled selected>‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>';
      } else {
        timeSelect.innerHTML = '<option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á</option>';
        availableTimes.forEach(time => {
          const option = document.createElement('option');
          option.value = time;
          option.textContent = time;
          timeSelect.appendChild(option);
        });
      }
      loader.classList.remove('visible');
    });

    form.addEventListener('submit', async e => {
      e.preventDefault();

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ
      const name = form.name.value.trim();
      const phone = form.phone.value.trim();
      const lineId = form.lineId.value.trim();
      const date = form.date.value;
      const time = form.time.value;

      if (!name || !phone || !lineId || !date || !time) {
        alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß');
        return;
      }

      loader.classList.add('visible');

      const dateTime = `${date}T${time}:00+07:00`; // timezone +7

      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'bookQueue',
            booking: { name, phone, lineId, dateTime, note: '' }
          })
        });

        const data = await res.json();

        if (data.success) {
          // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏°
          form.style.display = 'none';
          confirmation.classList.add('visible');
          confirmDetails.textContent = `
‡∏ä‡∏∑‡πà‡∏≠: ${name}
‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${phone}
Line ID: ${lineId}
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${date}
‡πÄ‡∏ß‡∏•‡∏≤: ${time}
‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ${data.message || '‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'}
          `.trim();
        } else {
          alert(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß');
        }
      } catch (error) {
        alert('üö´ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
        console.error(error);
      } finally {
        loader.classList.remove('visible');
      }
    });

    bookAgainBtn.addEventListener('click', () => {
      confirmation.classList.remove('visible');
      form.style.display = '';
      form.reset();
      timeSelect.innerHTML = '<option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á</option>';
    });
  </script>
</body>
</html>
